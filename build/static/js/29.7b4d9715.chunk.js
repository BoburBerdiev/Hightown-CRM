"use strict";(self.webpackChunkhightowncity_crm=self.webpackChunkhightowncity_crm||[]).push([[29],{84268:(e,a,s)=>{s.d(a,{A:()=>n});s(65043);var t=s(50289),r=s(33307),i=s(70579);const n=e=>{let{label:a,name:s,required:n,required_text:o,warning:l}=e;return(0,i.jsx)(t.A.Item,{label:l?(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:a}),(0,i.jsx)("br",{}),(0,i.jsx)("p",{children:l})]}):(0,i.jsx)("div",{children:a}),name:s,rules:[{required:n,message:o}],children:(0,i.jsx)(r.A,{})})}},65923:(e,a,s)=>{s.d(a,{A:()=>n});s(65043);var t=s(50289),r=s(3428),i=s(70579);const n=e=>{let{label:a,name:s,required:n,required_text:o}=e;return(0,i.jsx)(t.A.Item,{label:a,name:s,rules:[{required:n,message:o}],children:(0,i.jsx)(r.A,{style:{width:"100%"}})})}},20029:(e,a,s)=>{s.r(a),s.d(a,{default:()=>j});var t=s(65043),r=s(50289),i=s(48193),n=s(47419),o=s(11645),l=s(22895),d=s(89421),u=s(82907),c=s(59888),m=s(53648),p=s(73216),v=s(14556),h=s(36213),g=s(84268),f=s(59488),A=s(65923),x=s(70579);const w={fulName:"",phoneNumber:"",userName:"",password:"",imageId:[]},j=()=>{const[e]=r.A.useForm(),a=(0,p.Zp)(),{editId:s}=(0,v.d4)((e=>e.editData)),j=(0,v.wA)(),[y,b]=(0,t.useState)([]),[S,N]=(0,t.useState)(null),{mutate:F,data:I,isLoading:q,isSuccess:E}=(0,u.useMutation)((e=>{let{url:a,formData:s}=e;return c.A.postData(a,s)}),{onSuccess:()=>{i.Ay.success("Success")},onError:e=>{for(let n in null===(a=e.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.errors){var a,s,t,r;i.Ay.error("".concat(n,": ").concat(null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.errors[n]))}}}),{mutate:D,data:L,isLoading:V,isSuccess:_}=(0,u.useMutation)((e=>{let{url:a,data:s}=e;return c.A.postData(a,s)}),{onSuccess:()=>{i.Ay.success("Success")},onError:e=>{for(let a in e.response.data)i.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{isLoading:C,data:U,refetch:M,isSuccess:T}=(0,u.useQuery)(["edit-user",s],(()=>c.A.getDataByID("/User",s)),{enabled:!1}),{mutate:k,isLoading:O,data:R,isSuccess:z}=(0,u.useMutation)((e=>{let{url:a,data:s,id:t}=e;return c.A.editData(a,s,t)}),{onSuccess:()=>{i.Ay.success("Success")},onError:e=>{for(let a in e.response.data)i.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{mutate:H,isLoading:J,data:P,isSuccess:B}=(0,u.useMutation)((e=>{let{url:a,data:s,id:t}=e;return c.A.editData(a,s,t)}),{onSuccess:()=>{i.Ay.success("Success")},onError:e=>{for(let a in e.response.data)i.Ay.error("".concat(a,": ").concat(e.response.data[a]))}});(0,t.useEffect)((()=>{z&&j({type:h.aT,payload:""}),(_||z)&&a("/user")}),[L,R]),(0,t.useEffect)((()=>{""!==s&&M()}),[s]),(0,t.useEffect)((()=>{""===s&&e.setFieldsValue(w)}),[]),(0,t.useEffect)((()=>{let a=null;var s,t;void 0!==U&&(a=[{uid:null===U||void 0===U||null===(s=U.image)||void 0===s?void 0:s.id,name:null===U||void 0===U||null===(t=U.image)||void 0===t?void 0:t.id,status:"done",url:"".concat("https://admin.hightowncity.uz/","/").concat(null===U||void 0===U?void 0:U.image.path)}]);if(T){const s={name:null===U||void 0===U?void 0:U.name,userName:null===U||void 0===U?void 0:U.userName,password:null===U||void 0===U?void 0:U.password,phoneNumber:null===U||void 0===U?void 0:U.phoneNumber,fulName:null===U||void 0===U?void 0:U.fulName,imageId:a};b(a),e.setFieldsValue(s)}}),[U]);(0,t.useEffect)((()=>{const a=JSON.parse(localStorage.getItem("myFormValues"));a&&(a.images=[],e.setFieldsValue(a));const s=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",s),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",s)}}),[]),(0,t.useEffect)((()=>{let a=B?P:I;if(E||B){const s=[{uid:null===a||void 0===a?void 0:a.id,name:null===a||void 0===a?void 0:a.id,status:"done",url:"".concat("https://admin.hightowncity.uz/","/").concat(null===a||void 0===a?void 0:a.path)}];e.setFieldsValue({imageId:s}),b(s)}}),[I,P]);return(0,x.jsx)("div",{children:V||C||O||q||J?(0,x.jsx)(m.HE,{}):(0,x.jsxs)(r.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:w,onFinish:e=>{var a;const t={userName:e.userName,password:e.password,phoneNumber:e.phoneNumber,fulName:e.fulName,imageId:y[0]?null===(a=y[0])||void 0===a?void 0:a.uid:1};T?k({url:"/User",data:t,id:s}):D({url:"/User/",data:t})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,x.jsxs)(n.A,{gutter:20,children:[(0,x.jsx)(o.A,{span:12,children:(0,x.jsx)(g.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u043e\u043b\u043d\u043e\u0435 \u0424\u0418\u041e",label:"\u041f\u043e\u043b\u043d\u043e\u0435 \u0424\u0418\u041e",name:"fulName"})}),(0,x.jsx)(o.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",label:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",name:"phoneNumber"})}),(0,x.jsx)(o.A,{span:12,children:(0,x.jsx)(g.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f login",label:"Login",name:"userName"})}),(0,x.jsx)(o.A,{span:12,children:(0,x.jsx)(g.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u0430\u0440\u043e\u043b\u044c",label:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password"})})]}),(0,x.jsx)(n.A,{gutter:20,children:(0,x.jsx)(o.A,{span:12,children:(0,x.jsx)(r.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",name:"imageId",children:(0,x.jsx)(f.A,{children:(0,x.jsx)(l.A,{maxCount:1,fileList:y,listType:"picture-card",onChange:e=>{let{fileList:a}=e;const s=new FormData;0!==a.length&&(s.append("fromFile",a[0].originFileObj),T&&1!==S?H({url:"/Image",data:s,id:S}):F({url:"/Image/",formData:s}))},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const s=new FileReader;s.readAsDataURL(e.originFileObj),s.onload=()=>a(s.result)})));const s=new Image;s.src=a;const t=window.open(a);null===t||void 0===t||t.document.write(s.outerHTML)},onRemove:a=>{const s=null===a||void 0===a?void 0:a.uid;N(s),e.setFieldsValue({imageId:[]}),b([])},beforeUpload:()=>!1,children:y.length>0?"":"Upload"})})})})}),(0,x.jsx)(d.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:T?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=29.7b4d9715.chunk.js.map