"use strict";(self.webpackChunkhightowncity_crm=self.webpackChunkhightowncity_crm||[]).push([[566],{84268:(e,t,a)=>{a.d(t,{A:()=>l});a(65043);var s=a(50289),o=a(33307),i=a(70579);const l=e=>{let{label:t,name:a,required:l,required_text:n,warning:r}=e;return(0,i.jsx)(s.A.Item,{label:r?(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:t}),(0,i.jsx)("br",{}),(0,i.jsx)("p",{children:r})]}):(0,i.jsx)("div",{children:t}),name:a,rules:[{required:l,message:n}],children:(0,i.jsx)(o.A,{})})}},79185:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var s=a(65043),o=a(50289),i=a(48193),l=a(47419),n=a(11645),r=a(94406),d=a(22895),u=a(89421),c=a(82907),m=a(59888),v=a(53648),p=a(73216),h=a(14556),g=a(36213),f=a(84268),A=a(59488),y=a(70579);const x={name:"",slotId:null,imageId:[]},w=()=>{const[e]=o.A.useForm(),t=(0,p.Zp)(),{editId:a}=(0,h.d4)((e=>e.editData)),w=(0,h.wA)(),[j,I]=(0,s.useState)([]),[S,b]=(0,s.useState)(null),{data:F,refetch:D}=(0,c.useQuery)("get-slot",(()=>m.A.getData("/Slot")),{enabled:!1}),{mutate:E,data:L,isLoading:V,isSuccess:C}=(0,c.useMutation)((e=>{let{url:t,formData:a}=e;return m.A.postData(t,a)}),{onSuccess:()=>{i.Ay.success("Success")},onError:e=>{for(let l in null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.errors){var t,a,s,o;i.Ay.error("".concat(l,": ").concat(null===(s=e.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.errors[l]))}}}),{mutate:q,data:M,isLoading:H,isSuccess:T}=(0,c.useMutation)((e=>{let{url:t,data:a}=e;return m.A.postData(t,a)}),{onSuccess:()=>{i.Ay.success("Success")},onError:e=>{for(let t in e.response.data)i.Ay.error("".concat(t,": ").concat(e.response.data[t]))}}),{isLoading:k,data:O,refetch:_,isSuccess:P}=(0,c.useQuery)(["edit-house",a],(()=>m.A.getDataByID("/House",a)),{enabled:!1}),{mutate:R,isLoading:U,data:z,isSuccess:J}=(0,c.useMutation)((e=>{let{url:t,data:a,id:s}=e;return m.A.editData(t,a,s)}),{onSuccess:()=>{i.Ay.success("Success")},onError:e=>{for(let t in e.response.data)i.Ay.error("".concat(t,": ").concat(e.response.data[t]))}}),{mutate:N,isLoading:Q,data:B,isSuccess:W}=(0,c.useMutation)((e=>{let{url:t,data:a,id:s}=e;return m.A.editData(t,a,s)}),{onSuccess:()=>{i.Ay.success("Success")},onError:e=>{for(let t in e.response.data)i.Ay.error("".concat(t,": ").concat(e.response.data[t]))}});(0,s.useEffect)((()=>{J&&w({type:g.aT,payload:""}),(T||J)&&t("/house")}),[M,z]),(0,s.useEffect)((()=>{""!==a&&_()}),[a]),(0,s.useEffect)((()=>{""===a&&e.setFieldsValue(x),D()}),[]),(0,s.useEffect)((()=>{let t=null;var a,s;void 0!==O&&(t=[{uid:null===O||void 0===O||null===(a=O.image)||void 0===a?void 0:a.id,name:null===O||void 0===O||null===(s=O.image)||void 0===s?void 0:s.id,status:"done",url:"".concat("https://admin.hightowncity.uz/","/").concat(null===O||void 0===O?void 0:O.image.path)}]);if(P){var o;const a={name:null===O||void 0===O?void 0:O.name,slotId:null===O||void 0===O||null===(o=O.slot)||void 0===o?void 0:o.id,imageId:t};I(t),e.setFieldsValue(a)}}),[O]);(0,s.useEffect)((()=>{const t=JSON.parse(localStorage.getItem("myFormValues"));t&&(t.images=[],e.setFieldsValue(t));const a=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",a),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",a)}}),[]),(0,s.useEffect)((()=>{let t=W?B:L;if(C||W){const a=[{uid:null===t||void 0===t?void 0:t.id,name:null===t||void 0===t?void 0:t.id,status:"done",url:"".concat("https://admin.hightowncity.uz/","/").concat(null===t||void 0===t?void 0:t.path)}];e.setFieldsValue({imageId:a}),I(a)}}),[L,B]);const Z=(0,s.useMemo)((()=>{var e;return null===F||void 0===F||null===(e=F.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[F]);return(0,y.jsx)("div",{children:H||k||U||V||Q?(0,y.jsx)(v.HE,{}):(0,y.jsxs)(o.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:x,onFinish:e=>{var t;const s={name:e.name,slotId:e.slotId,imageId:null===(t=j[0])||void 0===t?void 0:t.uid};P?R({url:"/House",data:s,id:a}):q({url:"/House/",data:s})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,y.jsxs)(l.A,{gutter:20,children:[(0,y.jsx)(n.A,{span:12,children:(0,y.jsx)(f.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043c",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043c",name:"name"})}),(0,y.jsx)(n.A,{span:12,children:(0,y.jsx)(o.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043b\u043e\u0442",name:"slotId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u043b\u043e\u0442"}],wrapperCol:{span:24},children:(0,y.jsx)(r.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0441\u043b\u043e\u0442",optionLabelProp:"label",options:Z})})})]}),(0,y.jsx)(l.A,{gutter:20,children:(0,y.jsx)(n.A,{span:12,children:(0,y.jsx)(o.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043e\u043c\u0430",name:"imageId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,y.jsx)(A.A,{children:(0,y.jsx)(d.A,{maxCount:1,fileList:j,listType:"picture-card",onChange:e=>{let{fileList:t}=e;const a=new FormData;0!==t.length&&(a.append("fromFile",t[0].originFileObj),P&&S?N({url:"/Image",data:a,id:S}):E({url:"/Image/",formData:a}))},onPreview:async e=>{let t=e.url;t||(t=await new Promise((t=>{const a=new FileReader;a.readAsDataURL(e.originFileObj),a.onload=()=>t(a.result)})));const a=new Image;a.src=t;const s=window.open(t);null===s||void 0===s||s.document.write(a.outerHTML)},onRemove:t=>{const a=null===t||void 0===t?void 0:t.uid;b(a),e.setFieldsValue({imageId:[]}),I([])},beforeUpload:()=>!1,children:j.length>0?"":"Upload"})})})})}),(0,y.jsx)(u.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:P?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=566.cab7e635.chunk.js.map